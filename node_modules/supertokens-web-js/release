#!/bin/sh

SUPERTOKENS_API_KEY=$(cat ./apiPassword)
# Initialize an empty JSON object string
jsonPayload="{\"password\": \"$SUPERTOKENS_API_KEY\""
# Iterate through all files in the ./bundle directory
for file in ./bundle/*; do
    # Extract the filename without the path
    filename=$(basename "$file")

    # Extract the name part (before the first dot)
    name="${filename%%.*}"

    # Add the key-value pair to the JSON object string
    if [ -n "$jsonPayload" ] && [ "$jsonPayload" != "{" ]; then
        jsonPayload+=","
    fi
    jsonPayload+="\"$name\":\"https://cdn.jsdelivr.net/gh/supertokens/supertokens-web-js@v0.16.0/bundle/$filename\""
done
# Close the JSON object
jsonPayload+="}"

curl --fail-with-body -X PUT \
    https://api.supertokens.io/0/frontend/web-js \
    -H 'Content-Type: application/json' \
    -H 'api-version: 0' \
    -d "${jsonPayload}"
